<html>
  <head>
    <title>
      Mural Client
    </title>

    <script src="http://127.0.0.1:9810/compile?id=client-test&mode=RAW" type="text/javascript"></script>
  </head>
  <body>
    <div id="dbg">
      <div><a href="javascript:doPost()">Do post</a></div>
    </div>
    <script type="text/javascript">
      var channel;
      var doPost;
      var rest = function() {
        var baseUrl = window.location.toString();
        var msgStream = baseUrl + "/connect";

        var handleOpen = function() {
          show("<b>OPEN</b>");
        };
        var handleHeaders = function() {
          show("<b>HEADERS</b>");
        };
        var handleData = function(event) {
          show("<i>" + goog.json.serialize(event.data) + "</i>");
        };
        var handleDone = function() {
          show("<b>DONE</b>");
        };

        var postUrl = baseUrl + "/choose_image";
        
        doPost = function() {
          var pxhr = new XMLHttpRequest();
          pxhr.open("POST", postUrl);
          pxhr.send();
        }

        var container = document.getElementById("dbg");
        var show = function(text) {
          container.innerHTML += "<div>" + text + "</div>";
        };

        channel = new ble.net.ChunkedChannel();
        goog.events.listen(channel, ble.net.EventType.OPEN, handleOpen);
        goog.events.listen(channel, ble.net.EventType.HEADERS, handleHeaders);
        goog.events.listen(channel, ble.net.EventType.DATA, handleData);
        goog.events.listen(channel, ble.net.EventType.DONE, handleDone);
        channel.open("GET", msgStream);
        channel.send();
      }; 
      goog.events.listen(window, goog.events.EventType.LOAD, rest);
    </script>
  </body>
</html>
